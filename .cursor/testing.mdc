---
description: 
globs: test*.py,*test.py
alwaysApply: false
---
基于 FastAPI 的 HTTP 后端服务的测试策略和最佳实践。

## 测试原则

- 只测试最重要的业务逻辑，避免过度测试
- 当测试出错时，请仔细分别到底是被测试业务代码的错误，还是当前测试代码的错误
- 在测试过程中，可以对不合理、不便于测试的代码提出修改建议
- 问自己："如果这个功能坏了，我的测试能发现吗？"
- 避免测试：编译器或语言已经保证的功能
- 测试组合，减少重复
- 测试真实的使用场景

## 测试分层架构

测试金字塔结构

- E2E：少量，端到端完整业务流程
- Integration：中等，组件间协作
- Unit Tests：大量，单个函数/类

## 单元测试 (Unit Tests)

- 测试单个函数或类的行为
- 使用Mock隔离所有外部依赖
- 快速执行，无外部IO
- 高代码覆盖率
- 与被测试源代码文件目录结构保持一致

## 集成测试 (Integration Tests)

- 测试多个组件间的协作
- 使用测试数据库和真实配置
- 验证数据流和业务逻辑
- 遵循相同的目录结构原则

## 端到端测试 (E2E Tests)

- 模拟真实用户场景
- 测试完整的业务流程
- 包含所有系统组件

## 性能测试 (Performance Tests)

- 验证响应时间和吞吐量
- 测试并发负载
- 监控资源使用

## 技术栈特定的测试策略

- pytest 配置优先在 pyproject.toml 中定义
- 尽量少使用 pytest hook functions, 直接使用 mark
- FastAPI 测试需要使用 mock 时，使用 httpx
- 测试函数命名规范：`test_<scenario>_<expected_result>`
